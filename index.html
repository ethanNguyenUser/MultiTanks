<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MultiTanks - MIDI Tank Battle</title>
    
    <!-- WebMidi.js library for MIDI input -->
    <script src="https://cdn.jsdelivr.net/npm/webmidi@3.1.0/dist/iife/webmidi.iife.js"></script>
    
    <!-- Game modules -->
    <script src="js/constants.js"></script>
    <script src="js/audioSystem.js"></script>
    <script src="js/renderer.js"></script>
    <script src="js/powerups.js"></script>
    <script src="js/collisions.js"></script>
    <script src="js/modes/modeManager.js"></script>
    <script src="js/modes/ffaMode.js"></script>
    <script src="js/modes/tdmMode.js"></script>
    <script src="js/modes/campaignMode.js"></script>
    <script src="js/midiHandler.js"></script>
    <script src="js/aiBehavior.js"></script>
    <script src="js/game.js"></script>
    <script src="js/menu.js"></script>
</head>
<body>
    <!-- Menu and game content will be generated by JavaScript -->
    
    <script>
        // =============================================================================
        // MAIN APPLICATION INITIALIZATION
        // =============================================================================
        
        // Initialize the application when the page loads
        window.addEventListener('load', function() {
            console.log('ðŸš€ MultiTanks Application Starting...');
            
            // Initialize audio system
            window.audioSystem.init();
            
            // Initialize the menu system
            window.menu.initialize();
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', function(event) {
                // ESC key to return to menu from game
                if (event.key === 'Escape' && window.menu.currentScreen === 'game') {
                    window.menu.returnToMenu();
                }
                
                // P key to pause/unpause game
                if (event.key === 'p' || event.key === 'P') {
                    if (window.game && window.menu.currentScreen === 'game') {
                        window.game.togglePause();
                    }
                }
                
                // M key to toggle audio
                if (event.key === 'm' || event.key === 'M') {
                    const enabled = window.audioSystem.toggle();
                    console.log(`ðŸ”Š Audio ${enabled ? 'enabled' : 'disabled'}`);
                }
            });
            
            console.log('âœ… MultiTanks Application Ready!');
            console.log('ðŸ“‹ Controls:');
            console.log('  - ESC: Return to menu');
            console.log('  - P: Pause/Unpause game');
            console.log('  - M: Toggle audio on/off');
            console.log('  - MIDI: Use your MIDI keyboard to control tanks');
        });
        
        // Handle page visibility changes (pause when tab is not active)
        document.addEventListener('visibilitychange', function() {
            if (window.game && window.menu.currentScreen === 'game') {
                if (document.hidden) {
                    window.game.isPaused = true;
                } else {
                    window.game.isPaused = false;
                    if (window.game.gameState === GAME_STATES.PLAYING) {
                        window.game.lastTime = performance.now();
                        window.game.gameLoop();
                    }
                }
            }
        });
        
        // Handle window resize
        window.addEventListener('resize', function() {
            if (window.game && window.game.canvas) {
                // Update game constants with new window size
                GAME_CONFIG.MAP_WIDTH = window.innerWidth;
                GAME_CONFIG.MAP_HEIGHT = window.innerHeight;
                
                // Resize canvas
                window.game.canvas.width = GAME_CONFIG.MAP_WIDTH;
                window.game.canvas.height = GAME_CONFIG.MAP_HEIGHT;
            }
        });
    </script>
</body>
</html>
